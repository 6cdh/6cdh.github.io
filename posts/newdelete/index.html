<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>How new is implemented | 6cdh's Blog</title><meta property='og:title' content="How new is implemented - 6cdh's Blog"><meta property='og:description' content='You may be asked what&rsquo;s the difference between new and malloc. In fact, they are completely different. However, in a sense, they are almost no difference.'><meta property='og:url' content='https://6cdh.github.io/posts/newdelete/'><meta property='og:site_name' content="6cdh's Blog"><meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/b8cddc4add92aa9aa4ad41498604c028?s=256'><meta property='article:section' content='Posts'><meta property='article:tag' content='c++'><meta property='article:published_time' content='2021-04-21T23:41:50+08:00'><meta property='article:modified_time' content='2021-04-21T23:41:50+08:00'><meta name=twitter:card content='summary'><meta name=twitter:site content='@'><meta name=twitter:creator content='@'><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://6cdh.github.io/custom.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://6cdh.github.io/posts/newdelete/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://6cdh.github.io/><h1 id=nav-heading class="title is-4">6cdh's Blog</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/6cdh target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</i></span></a><a class=level-item aria-label=email href=mailto:cd6cdh@gmail.com target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/c++/>#c++</a></div><h2 class="subtitle is-6">April 21, 2021</h2><h1 class=title>How new is implemented</h1><div class=content><p>You may be asked what&rsquo;s the difference between <code>new</code> and <code>malloc</code>. In fact, they are completely different. However, in a sense, they are almost no difference.</p><p>We wrote this code:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#2838b0;font-style:italic>int</span> <span style=color:#785840>main</span><span style=color:#888>()</span> <span style=color:#888>{</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>auto</span> ptr <span style=color:#666>=</span> <span style=color:#2838b0>new</span> <span style=color:#2838b0;font-style:italic>int</span><span style=color:#888>;</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>delete</span> ptr<span style=color:#888>;</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span></code></pre></div><p>then compiled with clang 12:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#289870>main:</span>                                   <span style=color:#888;font-style:italic># @main
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>        <span style=color:#785840>push</span>    <span style=color:#b85820>rbp</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>rbp</span><span style=color:#888>,</span> <span style=color:#b85820>rsp</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>sub</span>     <span style=color:#b85820>rsp</span><span style=color:#888>,</span> <span style=color:#444>32</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>dword</span> <span style=color:#b85820>ptr</span> <span style=color:#888>[</span><span style=color:#b85820>rbp</span> <span style=color:#888>-</span> <span style=color:#444>4</span><span style=color:#888>],</span> <span style=color:#444>0</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>edi</span><span style=color:#888>,</span> <span style=color:#444>4</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>call</span>    <span style=color:#b85820>operator</span> <span style=color:#b85820>new</span><span style=color:#888>(</span><span style=color:#b85820>unsigned</span> <span style=color:#b85820>long</span><span style=color:#888>)</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>qword</span> <span style=color:#b85820>ptr</span> <span style=color:#888>[</span><span style=color:#b85820>rbp</span> <span style=color:#888>-</span> <span style=color:#444>16</span><span style=color:#888>],</span> <span style=color:#b85820>rax</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>rax</span><span style=color:#888>,</span> <span style=color:#b85820>qword</span> <span style=color:#b85820>ptr</span> <span style=color:#888>[</span><span style=color:#b85820>rbp</span> <span style=color:#888>-</span> <span style=color:#444>16</span><span style=color:#888>]</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>qword</span> <span style=color:#b85820>ptr</span> <span style=color:#888>[</span><span style=color:#b85820>rbp</span> <span style=color:#888>-</span> <span style=color:#444>24</span><span style=color:#888>],</span> <span style=color:#b85820>rax</span>       <span style=color:#888;font-style:italic># 8-byte Spill
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>        <span style=color:#785840>cmp</span>     <span style=color:#b85820>rax</span><span style=color:#888>,</span> <span style=color:#444>0</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>je</span>      <span style=color:#b85820>.LBB1_2</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>rdi</span><span style=color:#888>,</span> <span style=color:#b85820>qword</span> <span style=color:#b85820>ptr</span> <span style=color:#888>[</span><span style=color:#b85820>rbp</span> <span style=color:#888>-</span> <span style=color:#444>24</span><span style=color:#888>]</span>       <span style=color:#888;font-style:italic># 8-byte Reload
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>        <span style=color:#785840>call</span>    <span style=color:#b85820>operator</span> <span style=color:#b85820>delete</span><span style=color:#888>(</span><span style=color:#b85820>void</span><span style=color:#888>*)</span>
</span></span><span style=display:flex><span><span style=color:#289870>.LBB1_2:</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>mov</span>     <span style=color:#b85820>eax</span><span style=color:#888>,</span> <span style=color:#b85820>dword</span> <span style=color:#b85820>ptr</span> <span style=color:#888>[</span><span style=color:#b85820>rbp</span> <span style=color:#888>-</span> <span style=color:#444>4</span><span style=color:#888>]</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>add</span>     <span style=color:#b85820>rsp</span><span style=color:#888>,</span> <span style=color:#444>32</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>pop</span>     <span style=color:#b85820>rbp</span>
</span></span><span style=display:flex><span>        <span style=color:#785840>ret</span>
</span></span></code></pre></div><p>The <code>new</code> and <code>delete</code> expressions are replaced by the <code>operator new</code> and <code>operator delete</code> functions. These functions don&rsquo;t exist in C++ standard library. So, they should be implementation-specific.</p><p>Let&rsquo;s see libstdc++ source for <code>operator new</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#888;font-style:italic>// gcc/libstdc++-v3/libsupc++/new_op.cc
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>_GLIBCXX_WEAK_DEFINITION <span style=color:#2838b0;font-style:italic>void</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span><span style=color:#2838b0>operator</span> <span style=color:#785840>new</span> <span style=color:#888>(</span>std<span style=color:#666>::</span>size_t sz<span style=color:#888>)</span> _GLIBCXX_THROW <span style=color:#888>(</span>std<span style=color:#666>::</span>bad_alloc<span style=color:#888>)</span>
</span></span><span style=display:flex><span><span style=color:#888>{</span>
</span></span><span style=display:flex><span>  <span style=color:#2838b0;font-style:italic>void</span> <span style=color:#666>*</span>p<span style=color:#888>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#888;font-style:italic>/* malloc (0) is unpredictable; avoid it.  */</span>
</span></span><span style=display:flex><span>  <span style=color:#2838b0>if</span> <span style=color:#888>(</span>__builtin_expect <span style=color:#888>(</span>sz <span style=color:#666>==</span> <span style=color:#444>0</span><span style=color:#888>,</span> <span style=color:#388038>false</span><span style=color:#888>))</span>
</span></span><span style=display:flex><span>    sz <span style=color:#666>=</span> <span style=color:#444>1</span><span style=color:#888>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#2838b0>while</span> <span style=color:#888>((</span>p <span style=color:#666>=</span> malloc <span style=color:#888>(</span>sz<span style=color:#888>))</span> <span style=color:#666>==</span> <span style=color:#444>0</span><span style=color:#888>)</span>
</span></span><span style=display:flex><span>    <span style=color:#888>{</span>
</span></span><span style=display:flex><span>      new_handler handler <span style=color:#666>=</span> std<span style=color:#666>::</span>get_new_handler <span style=color:#888>();</span>
</span></span><span style=display:flex><span>      <span style=color:#2838b0>if</span> <span style=color:#888>(</span><span style=color:#666>!</span> handler<span style=color:#888>)</span>
</span></span><span style=display:flex><span>	_GLIBCXX_THROW_OR_ABORT<span style=color:#888>(</span>bad_alloc<span style=color:#888>());</span>
</span></span><span style=display:flex><span>      handler <span style=color:#888>();</span>
</span></span><span style=display:flex><span>    <span style=color:#888>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#2838b0>return</span> p<span style=color:#888>;</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// gcc/libstdc++-v3/libsupc++/new_opv.cc
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>_GLIBCXX_WEAK_DEFINITION <span style=color:#2838b0;font-style:italic>void</span><span style=color:#666>*</span>
</span></span><span style=display:flex><span><span style=color:#2838b0>operator</span> <span style=color:#2838b0>new</span><span style=color:#888>[]</span> <span style=color:#888>(</span>std<span style=color:#666>::</span>size_t sz<span style=color:#888>)</span> _GLIBCXX_THROW <span style=color:#888>(</span>std<span style=color:#666>::</span>bad_alloc<span style=color:#888>)</span>
</span></span><span style=display:flex><span><span style=color:#888>{</span>
</span></span><span style=display:flex><span>  <span style=color:#2838b0>return</span> <span style=color:#666>::</span><span style=color:#2838b0>operator</span> <span style=color:#2838b0>new</span><span style=color:#888>(</span>sz<span style=color:#888>);</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span></code></pre></div><p>The <code>operator new</code> function simply calls <code>malloc</code>. If failed, <code>new_handler</code> will be used to solve it. If <code>new_handler</code> is a null pointer, <code>std::bad_alloc</code> will be raised. No matter what method, the new expression would succeed to allocate memory if it returns.</p><p>If <code>new_handler</code> really does nothing, new expression will block.</p><p>Therefore, the following program will block.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#289870>#include</span> <span style=color:#289870>&lt;new&gt;</span><span style=color:#289870>
</span></span></span><span style=display:flex><span><span style=color:#289870></span>
</span></span><span style=display:flex><span><span style=color:#2838b0;font-style:italic>void</span> <span style=color:#785840>handler</span><span style=color:#888>()</span> <span style=color:#888>{</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2838b0;font-style:italic>int</span> <span style=color:#785840>main</span><span style=color:#888>()</span> <span style=color:#888>{</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>auto</span> new_handler <span style=color:#666>=</span> std<span style=color:#666>::</span>get_new_handler<span style=color:#888>();</span>
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>set_new_handler<span style=color:#888>(</span>handler<span style=color:#888>);</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>auto</span> ptr <span style=color:#666>=</span> <span style=color:#2838b0>new</span> <span style=color:#2838b0;font-style:italic>int</span><span style=color:#888>[</span><span style=color:#444>10&#39;000&#39;000&#39;000</span><span style=color:#888>];</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>delete</span><span style=color:#888>[]</span> ptr<span style=color:#888>;</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span></code></pre></div><p>Another unexpected thing is <code>new[]</code> just simply call <code>new</code>. It&rsquo;s amazing. Maybe we can mix <code>new</code> and <code>new[]</code>? They just do the same thing.</p><p>Let&rsquo;s see how <code>delete</code> works.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#888;font-style:italic>// gcc/libstdc++-v3/libsupc++/del_op.cc
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>_GLIBCXX_WEAK_DEFINITION <span style=color:#2838b0;font-style:italic>void</span>
</span></span><span style=display:flex><span><span style=color:#2838b0>operator</span> <span style=color:#785840>delete</span><span style=color:#888>(</span><span style=color:#2838b0;font-style:italic>void</span><span style=color:#666>*</span> ptr<span style=color:#888>)</span> <span style=color:#2838b0>noexcept</span>
</span></span><span style=display:flex><span><span style=color:#888>{</span>
</span></span><span style=display:flex><span>  std<span style=color:#666>::</span>free<span style=color:#888>(</span>ptr<span style=color:#888>);</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// gcc/libstdc++-v3/libsupc++/del_opv.cc
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>_GLIBCXX_WEAK_DEFINITION <span style=color:#2838b0;font-style:italic>void</span>
</span></span><span style=display:flex><span><span style=color:#2838b0>operator</span> <span style=color:#2838b0>delete</span><span style=color:#888>[]</span> <span style=color:#888>(</span><span style=color:#2838b0;font-style:italic>void</span> <span style=color:#666>*</span>ptr<span style=color:#888>)</span> _GLIBCXX_USE_NOEXCEPT
</span></span><span style=display:flex><span><span style=color:#888>{</span>
</span></span><span style=display:flex><span>  <span style=color:#666>::</span><span style=color:#2838b0>operator</span> <span style=color:#2838b0>delete</span> <span style=color:#888>(</span>ptr<span style=color:#888>);</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span></code></pre></div><p><code>delete</code> and <code>delete[]</code> are wrappers of <code>free</code>. They also do the same thing!</p><p>That means we might be able to mix <code>new</code>, <code>new[]</code>, <code>delete</code> and <code>delete[]</code>.</p><p>For example</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#2838b0;font-style:italic>int</span> <span style=color:#785840>main</span><span style=color:#888>()</span> <span style=color:#888>{</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>auto</span> ptr <span style=color:#666>=</span> <span style=color:#2838b0>new</span> <span style=color:#2838b0;font-style:italic>int</span><span style=color:#888>[</span><span style=color:#444>10&#39;000</span><span style=color:#888>];</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>delete</span> ptr<span style=color:#888>;</span>
</span></span><span style=display:flex><span><span style=color:#888>}</span>
</span></span></code></pre></div><p>would not leak memory. We can use valgrind to verify it:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b04040>$valgrind</span> ./a.out
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span> Memcheck, a memory error <span style=color:#b04040>detector</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span> Copyright <span style=color:#666>(</span>C<span style=color:#666>)</span> 2002-2017, and GNU GPL<span style=color:#b83838>&#39;d, by Julian Seward et al.
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263== Using Valgrind-3.16.1 and LibVEX; rerun with -h for copyright info
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263== Command: ./a.out
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263==
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263== Mismatched free() / delete / delete []
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263==    at 0x483FEAB: operator delete(void*) (vg_replace_malloc.c:584)
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263==    by 0x10918A: main (in /home/lcdh/work/experimental/test/a.out)
</span></span></span><span style=display:flex><span><span style=color:#b83838>==233263==  Address 0x4d96c80 is 0 bytes inside a block of size 40,000 alloc&#39;</span><span style=color:#b04040>d</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>    at 0x483F50F: operator new<span style=color:#666>[](</span>unsigned long<span style=color:#666>)</span> <span style=color:#666>(</span>vg_replace_malloc.c:431<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>    by 0x109168: main <span style=color:#666>(</span>in /home/lcdh/work/experimental/test/a.out<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span> HEAP SUMMARY:
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>     in use at exit: <span style=color:#444>0</span> bytes in <span style=color:#444>0</span> <span style=color:#b04040>blocks</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>   total heap usage: <span style=color:#444>2</span> allocs, <span style=color:#444>2</span> frees, 112,704 bytes <span style=color:#b04040>allocated</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span> All heap blocks were freed -- no leaks are <span style=color:#b04040>possible</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span>
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span> For lists of detected and suppressed errors, rerun with: -s
</span></span><span style=display:flex><span><span style=color:#666>==</span><span style=color:#b04040>233263</span><span style=color:#666>==</span> ERROR SUMMARY: <span style=color:#444>1</span> errors from <span style=color:#444>1</span> contexts <span style=color:#666>(</span>suppressed: <span style=color:#444>0</span> from 0<span style=color:#666>)</span>
</span></span></code></pre></div><p>Really no leaks! Don&rsquo;t mind the error at the end. It just complains Mismatched <code>free() / delete / delete []</code>.</p><p>The implementation of libcxx is almost the same as libstdc++.</p><p>In conclusion, we can mix <code>new</code>, <code>new[]</code>, <code>delete</code> and <code>delete[]</code>. They call <code>malloc</code> and <code>free</code> to allocate and free memory. However, don&rsquo;t really mix them. Don&rsquo;t assume anything about implementation defined-behavior!</p></div></div></section><section class=section><div class=container><aside><div id=disqus_thread></div></aside><div id=show_comments><a id=load_comments class="button is-link">Load comments</a></div><script type=text/javascript>var hash,disqus_shortname="6cdh-github-io";function disqus(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}hash=window.location.hash.substr(1),hash.length>8&&hash.substring(0,8)==="comment-"?(disqus(),document.getElementById("show_comments").style.display="none"):document.getElementById("load_comments").onclick=function(){disqus(),document.getElementById("show_comments").style.display="none"}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p><p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/ribice/kiss>Kiss</a>.</p></div></section></body></html>