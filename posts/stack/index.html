<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>The Stack Sorting | 6cdh's Blog</title><meta property='og:title' content="The Stack Sorting - 6cdh's Blog"><meta property='og:description' content='Recently, I got stuck in the stack data structure. Everyone knows that the stack is a LIFO (Last In First Out) data structure. This is easy to understand, but not easy to use sometimes.'><meta property='og:url' content='https://6cdh.github.io/posts/stack/'><meta property='og:site_name' content="6cdh's Blog"><meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/b8cddc4add92aa9aa4ad41498604c028?s=256'><meta property='article:section' content='Posts'><meta property='article:tag' content='data structure'><meta property='article:published_time' content='2021-03-10T12:32:42+08:00'><meta property='article:modified_time' content='2021-03-10T12:32:42+08:00'><meta name=twitter:card content='summary'><meta name=twitter:site content='@'><meta name=twitter:creator content='@'><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://6cdh.github.io/custom.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://6cdh.github.io/posts/stack/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://6cdh.github.io/><h1 id=nav-heading class="title is-4">6cdh's Blog</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/6cdh target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</i></span></a><a class=level-item aria-label=email href=mailto:cd6cdh@gmail.com target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/data-structure/>#data structure</a></div><h2 class="subtitle is-6">March 10, 2021</h2><h1 class=title>The Stack Sorting</h1><div class=content><p>Recently, I got stuck in the stack data structure. Everyone knows that the stack is a LIFO <em>(Last In First Out)</em> data structure. This is easy to understand, but not easy to use sometimes.</p><p>Consider the stack sorting problem which is introduced by Knuth in the 1960s:</p><blockquote><p>Given the n-sized permutation $p = a_1 a_2\cdots a_{n-1} a_n$. This permutation is known
as the &lsquo;input&rsquo;. The only tool we have for sorting is a stack.</p></blockquote><p>How to do it? In the first step, we place $a_1$ into the stack. For the second step, we now compare it with the element $a_2$. If $a_1 > a_2$ then we place $a_2$ on the stack above of $a_1$, otherwise, we place $a_1$ into the output and place $a_2$ on the top of the stack.</p><p>For each step, we compare the leftmost element in the input with the element on the
top of the stack. The process ends when all the elements have been placed into the output
stack.</p><p>The Python code as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#2838b0>def</span> <span style=color:#785840>stack_sorting</span><span style=color:#888>(</span>a<span style=color:#888>:</span> List<span style=color:#888>)</span> <span style=color:#666>-&gt;</span> List<span style=color:#888>:</span>
</span></span><span style=display:flex><span>    a<span style=color:#666>.</span>append<span style=color:#888>(</span>math<span style=color:#666>.</span>inf<span style=color:#888>)</span>
</span></span><span style=display:flex><span>    stack <span style=color:#666>=</span> <span style=color:#888>[]</span>
</span></span><span style=display:flex><span>    output <span style=color:#666>=</span> <span style=color:#888>[]</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>for</span> v <span style=color:#a848a8>in</span> a<span style=color:#888>:</span>
</span></span><span style=display:flex><span>        <span style=color:#2838b0>while</span> stack <span style=color:#a848a8>and</span> stack<span style=color:#888>[</span><span style=color:#666>-</span><span style=color:#444>1</span><span style=color:#888>]</span> <span style=color:#666>&lt;=</span> v<span style=color:#888>:</span>
</span></span><span style=display:flex><span>            output<span style=color:#666>.</span>append<span style=color:#888>(</span>stack<span style=color:#666>.</span>pop<span style=color:#888>())</span>
</span></span><span style=display:flex><span>        stack<span style=color:#666>.</span>append<span style=color:#888>(</span>v<span style=color:#888>)</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>return</span> output
</span></span></code></pre></div><p>This algorithm will cost O(n) and is a comparative sorting. So it should have somewhat limitations. In fact, the algorithm can&rsquo;t sort a permutation that contains a 231-pattern:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#666>&gt;&gt;&gt;</span> stack_sorting<span style=color:#888>([</span><span style=color:#444>2</span><span style=color:#888>,</span> <span style=color:#444>3</span><span style=color:#888>,</span> <span style=color:#444>1</span><span style=color:#888>])</span>
</span></span><span style=display:flex><span><span style=color:#888>[</span><span style=color:#444>2</span><span style=color:#888>,</span> <span style=color:#444>1</span><span style=color:#888>,</span> <span style=color:#444>3</span><span style=color:#888>]</span>
</span></span></code></pre></div><p>To sort this type of permutation, we can take the output of the one stack sorting and sort it again with the stack. If the permutation is ordered after k sorts, we say the initial permutation is k stack sortable.</p><p>Then Let&rsquo;s go back to the one stack sorting to study its properties.</p><blockquote><p>Consider the permutation $p = a_1 a_2 \cdots a_{n-1} a_n$. Let $x = \max (a_1, a_2, \cdots, a_n)$. Let $p_L$ and $p_R$ be the terms such that $p = p_L x p_R$. Let $s(p)$ is the permutation after one stack sorting. Then</p><p>$$
s(p) = s(p_L)s(p_R)x
$$</p></blockquote><p>The proof is trivial. Every element before $x$ will enter and leave the stack before $x$ enters since it is larger. After $x$ enters the stack, every element after $x$ will enter and leave the stack before $x$ leaves the stack.</p><p>This property implies:</p><ul><li>The predecessor of $x$ in the output is the maximum of the elements after $x$.</li><li>The element on the top of the output is the maximum of the elements before $x$ when $x$
just enters the stack.</li></ul><p>Another property is the invariant of the one stack sorting algorithm:</p><blockquote><p>The top of the stack is the last greater element before $a_i$ when $a_i$ is ready to
push to the stack.</p></blockquote><p>The invariant is easy to prove. When $a_1$ is ready to push, the stack is empty and the
invariant holds. At the beginning of the ith cycle, the invariant holds, and the top of
the stack is $a_{i-1}$. If $a_{i-1} > a_i$, the invariant holds. If $a_{i-1} \le a_i$,
$a_{i-1}$ will be poped to the output. If the last greater element of $a_{i-1}$ less than
$a_i$, then we push $a_i$ to the stack. Otherwise, continue to pop it to the output. At
the end of the cycle, the invariant also holds.</p><p>Leetcode 503 <a href=https://leetcode.com/problems/next-greater-element-ii/>Next Greater Element II</a> is an example:</p><blockquote><p>Given a circular array (the next element of the last element is the first element of the array), print the Next Greater Number for every element. The Next Greater Number of a number x is the first greater number to its traversing-order next in the array, which means you could search circularly to find its next greater number. If it doesn&rsquo;t exist, output -1 for this number.</p></blockquote><p>We can reverse execution the stack sorting:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#2838b0>def</span> <span style=color:#785840>nextGreaterElements</span><span style=color:#888>(</span>nums<span style=color:#888>:</span> List<span style=color:#888>[</span><span style=color:#388038>int</span><span style=color:#888>])</span> <span style=color:#666>-&gt;</span> List<span style=color:#888>[</span><span style=color:#388038>int</span><span style=color:#888>]:</span>
</span></span><span style=display:flex><span>    n <span style=color:#666>=</span> <span style=color:#388038>len</span><span style=color:#888>(</span>nums<span style=color:#888>)</span>
</span></span><span style=display:flex><span>    stk <span style=color:#666>=</span> <span style=color:#888>[]</span>
</span></span><span style=display:flex><span>    ret <span style=color:#666>=</span> <span style=color:#888>[</span><span style=color:#666>-</span><span style=color:#444>1</span><span style=color:#888>]</span> <span style=color:#666>*</span> n
</span></span><span style=display:flex><span>    <span style=color:#2838b0>for</span> i <span style=color:#a848a8>in</span> <span style=color:#388038>reversed</span><span style=color:#888>(</span><span style=color:#388038>range</span><span style=color:#888>(</span><span style=color:#444>2</span> <span style=color:#666>*</span> n<span style=color:#888>)):</span>
</span></span><span style=display:flex><span>        <span style=color:#2838b0>while</span> stk <span style=color:#a848a8>and</span> stk<span style=color:#888>[</span><span style=color:#666>-</span><span style=color:#444>1</span><span style=color:#888>]</span> <span style=color:#666>&lt;=</span> nums<span style=color:#888>[</span>i <span style=color:#666>%</span> n<span style=color:#888>]:</span>
</span></span><span style=display:flex><span>            stk<span style=color:#666>.</span>pop<span style=color:#888>()</span>
</span></span><span style=display:flex><span>        <span style=color:#2838b0>if</span> stk<span style=color:#888>:</span>
</span></span><span style=display:flex><span>            ret<span style=color:#888>[</span>i <span style=color:#666>%</span> n<span style=color:#888>]</span> <span style=color:#666>=</span> stk<span style=color:#888>[</span><span style=color:#666>-</span><span style=color:#444>1</span><span style=color:#888>]</span>
</span></span><span style=display:flex><span>        stk<span style=color:#666>.</span>append<span style=color:#888>(</span>nums<span style=color:#888>[</span>i <span style=color:#666>%</span> n<span style=color:#888>])</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>return</span> ret
</span></span></code></pre></div><p>Let $a$ be the input, $r_i = a_j$ be the next greater number of $a_i$ in $a$. That means</p><p>$$
i &lt; j\land ( \forall k : i &lt; k &lt; j : a[i] \ge a[k] ) \land a[i] &lt; a[j]
$$</p><p>So we have</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#2838b0>def</span> <span style=color:#785840>nextGreaterElements</span><span style=color:#888>(</span>nums<span style=color:#888>:</span> List<span style=color:#888>[</span><span style=color:#388038>int</span><span style=color:#888>])</span> <span style=color:#666>-&gt;</span> List<span style=color:#888>[</span><span style=color:#388038>int</span><span style=color:#888>]:</span>
</span></span><span style=display:flex><span>    n <span style=color:#666>=</span> <span style=color:#388038>len</span><span style=color:#888>(</span>nums<span style=color:#888>)</span>
</span></span><span style=display:flex><span>    stk <span style=color:#666>=</span> <span style=color:#888>[]</span>
</span></span><span style=display:flex><span>    ret <span style=color:#666>=</span> <span style=color:#888>[</span><span style=color:#666>-</span><span style=color:#444>1</span><span style=color:#888>]</span> <span style=color:#666>*</span> n
</span></span><span style=display:flex><span>    <span style=color:#2838b0>for</span> i <span style=color:#a848a8>in</span> <span style=color:#388038>range</span><span style=color:#888>(</span><span style=color:#444>2</span> <span style=color:#666>*</span> n<span style=color:#888>):</span>
</span></span><span style=display:flex><span>        <span style=color:#2838b0>while</span> stk <span style=color:#a848a8>and</span> nums<span style=color:#888>[</span>stk<span style=color:#888>[</span><span style=color:#666>-</span><span style=color:#444>1</span><span style=color:#888>]]</span> <span style=color:#666>&lt;</span> nums<span style=color:#888>[</span>i <span style=color:#666>%</span> n<span style=color:#888>]:</span>
</span></span><span style=display:flex><span>            ret<span style=color:#888>[</span>stk<span style=color:#666>.</span>pop<span style=color:#888>()]</span> <span style=color:#666>=</span> nums<span style=color:#888>[</span>i <span style=color:#666>%</span> n<span style=color:#888>]</span>
</span></span><span style=display:flex><span>        stk<span style=color:#666>.</span>append<span style=color:#888>(</span>i <span style=color:#666>%</span> n<span style=color:#888>)</span>
</span></span><span style=display:flex><span>    <span style=color:#2838b0>return</span> ret
</span></span></code></pre></div><h2 id=references>References</h2><ul><li><a href=https://math.uchicago.edu/~may/VIGRE/VIGRE2007/REUPapers/FINALAPP/Lim.pdf>Brief Introduction on Stack Sorting - LIM, CONG HAN</a></li><li><a href=https://en.wikipedia.org/wiki/Stack-sortable_permutation>Stack-sortable permutation - Wikipedia</a></li></ul></div></div></section><section class=section><div class=container><aside><div id=disqus_thread></div></aside><div id=show_comments><a id=load_comments class="button is-link">Load comments</a></div><script type=text/javascript>var hash,disqus_shortname="6cdh-github-io";function disqus(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}hash=window.location.hash.substr(1),hash.length>8&&hash.substring(0,8)==="comment-"?(disqus(),document.getElementById("show_comments").style.display="none"):document.getElementById("load_comments").onclick=function(){disqus(),document.getElementById("show_comments").style.display="none"}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p><p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/ribice/kiss>Kiss</a>.</p></div></section></body></html>